# 节点测速功能

## 功能说明

本功能实现了对多个节点的网络速度测试，通过访问节点的图片URL来测量响应时间，并根据测速结果进行排序。

## 主要特性

### 1. 测速功能
- **单个节点测速**: 点击每个节点卡片上的"测速"按钮
- **批量测速**: 点击顶部的"测速所有节点"按钮
- **并发测速**: 支持同时测速多个节点，提高效率

### 2. 测速结果
- **响应时间**: 显示具体的毫秒数
- **状态颜色**: 
  - 🟢 绿色 (≤1000ms): 优秀
  - 🟡 黄色 (1001-3000ms): 良好  
  - 🟠 橙色 (>3000ms): 较慢
  - 🔴 红色: 测速失败

### 3. 排序功能
- 测速完成后自动按速度从快到慢排序
- 测速失败的节点会排在最后

### 4. 状态管理
- **测速中**: 显示"测速中..."状态
- **未测速**: 显示"未测速"状态
- **测速失败**: 显示"测速失败"状态

## 使用方法

1. **启动测速**: 点击"测速所有节点"按钮开始批量测速
2. **单独测速**: 点击任意节点卡片上的"测速"按钮
3. **重置结果**: 点击"重置"按钮清除所有测速结果
4. **查看排序**: 测速完成后节点会自动按速度排序

## 技术实现

### 核心方法

```dart
// 测速单个节点
Future<void> testNodeSpeed(int index)

// 测速所有节点
Future<void> testAllNodesSpeed()

// 按速度排序
void _sortNodesBySpeed()

// 重置测速结果
void resetSpeedTest()
```

### 测速原理

1. 使用 `Stopwatch` 记录请求开始时间
2. 通过 `Dio` 发起图片请求
3. 记录请求完成时间
4. 计算响应时间（毫秒）
5. 更新节点数据并触发UI更新

### 错误处理

- 设置10秒超时时间
- 测速失败时设置99999ms作为标记
- 网络错误时显示"测速失败"状态

## 配置说明

### 节点数据结构

```dart
{
  'imgUrl': '图片URL',      // 用于测速的图片地址
  'name': '节点名称',       // 节点显示名称
  'url': '节点URL',         // 节点实际地址
  'speed': '速度值',        // 速度显示值
  'isTesting': false,      // 是否正在测速
  'testResult': null,      // 测速结果（毫秒）
}
```

### 超时配置

```dart
options: Options(
  responseType: ResponseType.bytes,
  sendTimeout: const Duration(seconds: 10),
  receiveTimeout: const Duration(seconds: 10),
)
```

## 注意事项

1. 确保网络连接正常
2. 图片URL需要可访问
3. 测速过程中请勿频繁操作
4. 建议在WiFi环境下进行测速 